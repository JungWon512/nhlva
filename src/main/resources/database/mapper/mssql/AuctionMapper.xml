<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="auction">
    <select id="selectListAucEntry" parameterType="map" resultType="map">
    	SELECT 
		  	  A.NA_BZPLC               -- 사업장번호
			, A.SRA_INDV_AMNNO         -- 축산개체관리번호
			, A.SRA_SRS_DSC            -- 축산축종구분코드: 01
			, A.FHS_ID_NO              -- 농가식별번호
			, A.FARM_AMNNO             -- 농장관리번호
			, B.OSLP_NO                -- 원표번호 
			, B.AUC_PRG_SQ             -- 경매진행순서 (출품번호)	
			, A.BIRTH                  -- 생년월일  (생년)
			, A.MCOW_DSC               -- 어미소구분코드
			, A.KPN_NO                 -- KPN번호  (KPN)
			, A.INDV_SEX_C             -- 개체성별구분코드: 0없음1암2수3거세4미경산5비거세6프리마틴9공통  (성별)
			, CASE
				WHEN A.INDV_SEX_C = 0 THEN '없음'		
				WHEN A.INDV_SEX_C = 1 THEN '암'		
				WHEN A.INDV_SEX_C = 2 THEN '수'		
				WHEN A.INDV_SEX_C = 3 THEN '거세'		
				WHEN A.INDV_SEX_C = 4 THEN '미경산'		
				WHEN A.INDV_SEX_C = 5 THEN '비거세'		
				WHEN A.INDV_SEX_C = 6 THEN '프리마틴'		
				WHEN A.INDV_SEX_C = 9 THEN '공통'
				ELSE '-'
			END INDV_SEX_C_NAME
			, A.MCOW_SRA_INDV_AMNNO    -- 어미소축산개체관리번호
			, A.MATIME                 -- 산차  (산차)
			, A.SRA_INDV_PASG_QCN      -- 계대  (계대)
			, A.INDV_ID_NO             -- 개체식별번호  (개체번호)
			, A.SRA_INDV_BRDSRA_RG_NO  -- 축산개체종축등록번호
			, A.RG_DSC                 -- 등록구분번호
			, B.AUC_OBJ_DSC            -- 경매대상구분코드: 1송아지,2비육우,3번식우 (경매구분)
			, B.AUC_DT		           -- 경매일자 (경매일자)
			, DATE_FORMAT(STR_TO_DATE(B.AUC_DT,'%Y%m%d'),'%Y.%m.%d') AUC_DT_STR -- 경매일자 (경매일자) FORMAT	
			, B.TRMN_AMNNO             -- 거래인관리번호(중도매인기준정보번호)
			, B.LVST_AUC_PTC_MN_NO     -- 가축경매참여자번호(참가번호)
			, B.COW_SOG_WT             -- 우출하중량	      (중량)
			, B.FIR_LOWS_SBID_LMT_AM   -- 최초최저낙찰한도금액(원단위)
			, B.LOWS_SBID_LMT_AM       -- 최저낙찰한도금액  (최저가-원단위)
			, B.FIR_LOWS_SBID_LMT_AM/10000 FIR_LOWS_SBID_LMT_UPR   -- 최초최저낙찰한도금액(만원단위)
			, B.LOWS_SBID_LMT_AM/10000 LOWS_SBID_LMT_UPR       -- 최저낙찰한도금액  (최저가-만원단위)
			, B.LWPR_CHG_NT            -- 최저가변경횟수 
			, B.RMK_CNTN               -- 비고내용    (비고)
			, B.BRANDNM                -- 브랜드명    (브랜드)
			, B.SRA_PDMNM              -- 축산생산자명 (출하주명)
			, B.SRA_PD_RGNNM           -- 축산생산지역 (출하지역)
			, B.SRA_SBID_AM            -- 축산낙찰금액 (낙찰단가-원단위)
			, B.SRA_SBID_UPR           -- 축산낙찰단가 (낙찰단가-만단위)
			, B.SEL_STS_DSC            -- 판매상태구분코드: 11대기,22낙찰,23보류
			, B.PRNY_YN                -- 임신여부    (임신여부)
			, B.PRNY_MTCN              -- 임신개월수   (임신개월)
			, B.AUC_YN                 -- 경매여부    (경매여부)
			<if test="loginNo != null and loginNo != ''">
				, C.SBID_UPR                 -- 찜 가격 (단가)
			</if>	
		FROM TB_LA_IS_MM_INDV  A
		INNER JOIN TB_LA_IS_MH_SOG_COW B ON A.NA_BZPLC = B.NA_BZPLC 
										AND A.FARM_AMNNO = B.FARM_AMNNO
										AND A.FHS_ID_NO = B.FHS_ID_NO
										AND A.SRA_INDV_AMNNO = B.SRA_INDV_AMNNO
		<if test="loginNo != null and loginNo != ''">
			LEFT JOIN TB_LA_IS_MH_SOG_ZIM C ON B.NA_BZPLC =C.NA_BZPLC             
											AND B.AUC_OBJ_DSC = C.AUC_OBJ_DSC            
											AND B.AUC_DT = C.AUC_DT           
											AND B.OSLP_NO = C.OSLP_NO
											AND B.TRMN_AMNNO = #{loginNo}
		</if>
		INNER JOIN TB_LA_IS_BM_BZLOC D ON B.NA_BZPLC = D.NA_BZPLC
		WHERE 1=1
		AND D.NA_BZPLCNO = #{naBzPlcNo}
        <if test="searchTxt != null and searchTxt != ''">
            AND (
            	UPPER(B.SRA_PDMNM) LIKE '%' UPPER(#{searchTxt}) || '%'
            	OR UPPER(B.RMK_CNTN) LIKE '%' UPPER(#{searchTxt}) || '%'
            )
        </if>	
        <if test="searchDate != null and searchDate != ''">
            AND B.AUC_DT = #{searchDate}
        </if>
        <if test="searchAucObjDsc != null and searchAucObjDsc != ''">
			AND B.AUC_OBJ_DSC=#{searchAucObjDsc}
        </if>
		<choose>
			<when test="searchOrder != null and searchOrder !='' ">
				ORDER BY B.AUC_DT				
				<choose>
					<when test='searchOrder == "AUC_PRG_SQ"'>
						, B.AUC_PRG_SQ DESC
					</when>
					<when test='searchOrder == "SRA_PDMNM"'>
						,B.AUC_PRG_SQ ASC , B.SRA_PDMNM DESC
					</when>
					<when test='searchOrder == "KPN_NO"'>
						,B.AUC_PRG_SQ ASC , A.KPN_NO DESC
					</when>
					<otherwise>
						,B.AUC_PRG_SQ ASC
					</otherwise>
				</choose>				
			</when>
			<otherwise>
				ORDER BY B.AUC_DT ,B.AUC_OBJ_DSC ,B.AUC_PRG_SQ ASC
			</otherwise>
		</choose>
        <if test="pageSize != null and pageStart != null">
            LIMIT ${pageStart} , ${pageSize}
        </if>
    </select>

    <resultMap type="HashMap" id="AucNoticeMap">
        <result property="johpCd" column="NA_BZPLC"/>
        <result property="seqNo" column="SEQ_NO"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="delYn" column="DEL_YN"/>
        <result property="regDtm" column="FSRG_DTM"/>
        <result property="regUsrid" column="FSRGMN_ENO"/>
        <result property="uptDtm" column="LSCHG_DTM"/>
        <result property="uptUsrid" column="LS_CMENO"/>
    </resultMap>

    <select id="selectListNotice" parameterType="map" resultMap="AucNoticeMap">
        SELECT
        <include refid="allResultNoti"></include>
        FROM  tb_la_is_bm_noti
        <trim  prefix="WHERE" suffixOverrides="AND | OR">
            NA_BZPLC = #{johpCd} AND
            DEL_YN = #{delYn} AND
        </trim>
        <if test="order != null">
            ${order}
        </if>
        <if test="pageSize != null and pageStart != null">
            LIMIT ${pageStart} , ${pageSize}
        </if>
    </select>
    
    <select id="selectOneNotice" parameterType="map" resultMap="AucNoticeMap">
        SELECT
        <include refid="allResultNoti"></include>
        FROM  tb_la_is_bm_noti
        <trim  prefix="WHERE" suffixOverrides="AND | OR">
            NA_BZPLC = #{johpCd} AND
            SEQ_NO = #{seqNo} AND
        </trim>
    </select>
    
    <sql id="allResultNoti">
        <trim suffixOverrides=",">
            NA_BZPLC,
            SEQ_NO,
            TITLE,
            CONTENT,
            DEL_YN,
            DATE_FORMAT(FSRG_DTM,'%Y-%m-%d') FSRG_DTM,
            FSRGMN_ENO,
            DATE_FORMAT(LSCHG_DTM,'%Y-%m-%d') LSCHG_DTM,
            LS_CMENO,
        </trim>
    </sql>
    
	<sql id="selectListWatchInclude">
		SELECT 
			TLIMSC.AUC_DT  -- 경매일자
			,TLIMSC.AUC_PRG_SQ -- 경매번호(경매출품 순서 ?)
		 	,TLIMF.FTSNM -- 출하주
			,TLIMSC.SRA_INDV_AMNNO -- 개체번호
			,TLIMI.INDV_SEX_C -- 성별
			,TLIMSC.COW_SOG_WT  -- 중량
			,TLIMI.KPN_NO -- KPN
			,TLIMI.SRA_INDV_PASG_QCN -- 계대
			,TLIMSC.LOWS_SBID_LMT_AM -- 최저가
			,TLIMSC.SRA_SBID_AM -- 낙찰가
			,TLIMSC.SEL_STS_DSC -- 거래상태	
			,TLIMSC.RMK_CNTN -- 비고
		FROM TB_LA_IS_MH_SOG_COW TLIMSC 
		INNER JOIN TB_LA_IS_BM_BZLOC TLIBB ON TLIMSC.NA_BZPLC =TLIBB.NA_BZPLC 
		INNER JOIN TB_LA_IS_MM_FHS TLIMF ON TLIMSC.NA_BZPLC =TLIMF.NA_BZPLC 
										AND TLIMSC.FARM_AMNNO = TLIMF.FARM_AMNNO
										AND TLIMSC.FHS_ID_NO = TLIMF.FHS_ID_NO
		INNER JOIN TB_LA_IS_MM_INDV TLIMI ON TLIMSC.NA_BZPLC =TLIMI.NA_BZPLC 
										AND TLIMSC.FARM_AMNNO = TLIMI.FARM_AMNNO
										AND TLIMSC.FHS_ID_NO = TLIMI.FHS_ID_NO
										AND TLIMSC.SRA_INDV_AMNNO = TLIMI.SRA_INDV_AMNNO
		WHERE 1=1 
	</sql>
	<select id="selectListWatch" parameterType="map" resultType="map" >
		<include refid="selectListWatchInclude"></include>
		AND TLIBB.NA_BZPLCNO =#{naBzPlcNo} -- parameter place
		AND TLIMSC.AUC_OBJ_DSC='3'  -- 테스트용 데이터 고정 추후 api를 태워 현재경매 상태를 받아올예정
		AND TLIMSC.AUC_DT ='20210702' -- 테스트용 데이터 고정		 
		ORDER BY TLIMSC.AUC_DT ,TLIMSC.AUC_PRG_SQ ASC
	</select>
    <select id="selectNearAucDateQcn" parameterType="map" resultType="map">
		SELECT 
			MAX(AUC_DT) AUC_DT
			,MAX(DIFF) DIFF 
		FROM(
			SELECT 
				A.*
				,DATEDIFF(STR_TO_DATE(AUC_DT, '%Y%m%d'),SYSDATE()) DIFF
			FROM TB_LA_IS_MH_AUC_QCN A
			INNER JOIN TB_LA_IS_BM_BZLOC B ON A.NA_BZPLC = B.NA_BZPLC
			WHERE 1=1
			AND B.NA_BZPLCNO = #{naBzPlcNo}
		) AS TEMP		    
    </select>
    <select id="selectNearAucDateStn" parameterType="map" resultType="map">
		SELECT 
			MAX(AUC_DT) AUC_DT
			,MAX(DIFF) DIFF
		FROM(
			SELECT 
				A.*
				,DATEDIFF(STR_TO_DATE(AUC_DT, '%Y%m%d'),SYSDATE()) DIFF
			FROM TB_LA_IS_MH_AUC_STN A
			INNER JOIN TB_LA_IS_BM_BZLOC B ON A.NA_BZPLC = B.NA_BZPLC
			WHERE 1=1
			AND B.NA_BZPLCNO = #{naBzPlcNo}
		) AS TEMP		    
    </select>
    
    <select id="selectAucDateQcn" parameterType="map" resultType="map">
		SELECT 
			A.*
		FROM TB_LA_IS_MH_AUC_QCN A
		INNER JOIN TB_LA_IS_BM_BZLOC B ON A.NA_BZPLC = B.NA_BZPLC
		WHERE 1=1
		AND B.NA_BZPLCNO = #{naBzPlcNo}
		<if test="searchDate != null and searchDate != ''">
			AND A.AUC_DT = #{searchDate}
		</if>		
    </select>
    
    <select id="selectAucDateStn" parameterType="map" resultType="map">
		SELECT 
			A.*
		FROM TB_LA_IS_MH_AUC_STN A
		INNER JOIN TB_LA_IS_BM_BZLOC B ON A.NA_BZPLC = B.NA_BZPLC
		WHERE 1=1
		AND B.NA_BZPLCNO = #{naBzPlcNo}
		<if test="searchDate != null and searchDate != ''">
			AND A.AUC_DT = #{searchDate}
		</if>
    </select>
    
    <select id="selectAucDateList" parameterType="map" resultType="map">
		SELECT
			DISTINCT AUC_DT 
			,NA_BZPLC
			,DATE_FORMAT(STR_TO_DATE(AUC_DT,'%Y%m%d'),'%y.%m.%d') AUC_DT_STR
		FROM (
			SELECT AUC_DT ,NA_BZPLC 
			FROM TB_LA_IS_MH_AUC_QCN
			WHERE NA_BZPLC = #{naBzPlc}
			<choose>
				<when test = 'entryType == "B"'>
					AND AUC_DT BETWEEN DATE_FORMAT(DATE_SUB(DATE_ADD(SYSDATE() , INTERVAL 7 DAY), INTERVAL 6 MONTH),'%Y%m%d') 
						AND DATE_FORMAT(DATE_ADD(SYSDATE() , INTERVAL 7 DAY),'%Y%m%d')
				</when>
				<otherwise>
					AND AUC_DT BETWEEN DATE_FORMAT(DATE_SUB(SYSDATE() , INTERVAL 6 MONTH),'%Y%m%d')
						AND DATE_FORMAT(SYSDATE(),'%Y%m%d') 
				</otherwise>
			</choose> 
			UNION ALL
			SELECT AUC_DT ,NA_BZPLC 
			FROM TB_LA_IS_MH_AUC_STN
			WHERE NA_BZPLC = #{naBzPlc}
			<choose>
				<when test = 'entryType == "B"'>
					AND AUC_DT BETWEEN DATE_FORMAT(DATE_SUB(DATE_ADD(SYSDATE() , INTERVAL 7 DAY), INTERVAL 6 MONTH),'%Y%m%d')
						AND DATE_FORMAT(DATE_ADD(SYSDATE() , INTERVAL 7 DAY),'%Y%m%d')
				</when>
				<otherwise>
					AND AUC_DT BETWEEN DATE_FORMAT(DATE_SUB(SYSDATE() , INTERVAL 6 MONTH),'%Y%m%d')
						AND DATE_FORMAT(SYSDATE(),'%Y%m%d')
				</otherwise>
			</choose> 
		) TEMP	
		ORDER BY AUC_DT DESC
    </select>
    
    <!-- Front home화면 지역 리스트 2 -->
    <select id="selectBizLocList" parameterType="map" resultType="map">    	
		SELECT 
			NA_BZPLCNO
			, NA_BZPLCLOC 
			, CLNTNM
			, NA_BZPLC 
			, LAT 
			, LNG
			, FSRG_DTM 
			, FSRGMN_ENO
			, LSCHG_DTM 
			, LS_CMENO 
			, RMK_CNTN 
			, AUC_YN 
			, DEL_YN
			, AREAORD 
			, AREANM
		FROM TB_LA_IS_BM_BZLOC
		WHERE 1=1
		AND DEL_YN = 0
		<if test="naBzPlcLoc != null and naBzPlcLoc != ''">
			AND NA_BZPLCLOC = #{naBzPlcLoc}
		</if>
		ORDER BY 
			AUC_YN DESC,NA_BZPLCNO , NA_BZPLCLOC ,AREAORD
    </select>
    
    <!-- Front home화면 지역 리스트 1 -->
    <select id="selectBizList" parameterType="map" resultType="map">  
		SELECT NA_BZPLCLOC
			, CASE 	WHEN NA_BZPLCLOC = 'A31' THEN '경기/인천'
					WHEN NA_BZPLCLOC = 'A33' THEN '강원'
					WHEN NA_BZPLCLOC = 'A41' THEN '충남'
					WHEN NA_BZPLCLOC = 'A43' THEN '충북'
					WHEN NA_BZPLCLOC = 'A52' THEN '울산'
					WHEN NA_BZPLCLOC = 'A55' THEN '경남'
					WHEN NA_BZPLCLOC = 'A54' THEN '경북'
					WHEN NA_BZPLCLOC = 'A61' THEN '전남'
					WHEN NA_BZPLCLOC = 'A63' THEN '전북'
					WHEN NA_BZPLCLOC = 'A64' THEN '제주'
			ELSE '' END NA_BZPLCLOC_NM
			,SUM(AUC_YN) AUC_YN
			,sum(STN_CNT)+sum(QCN_CNT) CUR_AUC_CNT	
		FROM 
			(SELECT 
				LOC.NA_BZPLCLOC
				, LOC.AUC_YN
				, (SELECT COUNT(*) FROM TB_LA_IS_MH_AUC_QCN QCN 
					WHERE QCN.NA_BZPLC = LOC.NA_BZPLC 
					AND QCN.AUC_DT = DATE_FORMAT(SYSDATE(),'%Y%M%D')
				) QCN_CNT 
				, (SELECT COUNT(*) FROM TB_LA_IS_MH_AUC_STN STN 
					WHERE STN.NA_BZPLC = LOC.NA_BZPLC
					AND STN.AUC_DT = DATE_FORMAT(SYSDATE(),'%Y%M%D')
				) STN_CNT
			FROM TB_LA_IS_BM_BZLOC LOC
			WHERE LOC.DEL_YN = 0
			)TMP
		GROUP BY NA_BZPLCLOC
		ORDER BY NA_BZPLCLOC
    </select>
	
	<!-- 출품정보 리스트 -->
	<select id="selectAuctionEntry" parameterType="map" resultType="map">
		SELECT A.NA_BZPLC					/* 조합 구분 코드 */
			 , A.OSLP_NO					/* 출품번호 */
			 , (SELECT C.QCN
			 	  FROM TB_LA_IS_MH_AUC_QCN C
			 	 WHERE C.NA_BZPLC = A.NA_BZPLC
			 	   AND C.AUC_DT = A.AUC_DT
			 	   AND C.AUC_OBJ_DSC = A.AUC_OBJ_DSC) AS QCN	/* 경매회차 */
			 , A.AUC_PRG_SQ					/* 경매순번 */
			 , A.AUC_OBJ_DSC				/* 경매대상구분코드 */
			 , A.SRA_INDV_AMNNO				/* 축산개체관리번호 */
			 , A.SRA_SRS_DSC				/* 축상축종구분코드 */
			 , B.FHS_ID_NO 					/* 농가식별번호 */
			 , B.FARM_AMNNO 				/* 농장관리번호 */
			 , (SELECT C.FTSNM
				  FROM TB_LA_IS_MM_FHS C
				 WHERE C.NA_BZPLC = B.NA_BZPLC
				   AND C.FHS_ID_NO = B.FHS_ID_NO
				   AND C.FARM_AMNNO = B.FARM_AMNNO
			 ) AS FTSNM						/* 농가명 */
			 , A.BRANDNM					/* 브랜드명 */
			 , B.BIRTH						/* 생년월일 */
			 , RTRIM(LTRIM(B.KPN_NO)) AS KPN_NO	/* KPN번호 */
			 , B.INDV_SEX_C					/* 개체성별코드 */
			 , CASE WHEN B.INDV_SEX_C = '0' THEN '없음' WHEN B.INDV_SEX_C = '1' THEN '암'
			 		WHEN B.INDV_SEX_C = '2' THEN '수' WHEN B.INDV_SEX_C = '3' THEN '거세'
			 		WHEN B.INDV_SEX_C = '4' THEN '미경산' WHEN B.INDV_SEX_C = '5' THEN '비거세'
			 		WHEN B.INDV_SEX_C = '6' THEN '프리마틴' WHEN B.INDV_SEX_C = '9' THEN '공통'
			 		ELSE '-'
			 	END AS INDV_SEX_NAME		/* 개체성별코드명 */
			 , B.MCOW_DSC 					/* 어미소구분코드*/
			 , B.MCOW_SRA_INDV_AMNNO 		/* 어미축산개체관리번호 */
			 , CASE WHEN B.MCOW_DSC = '01' THEN '기초'
			 		WHEN B.MCOW_DSC = '02' THEN '혈통'
			 		WHEN B.MCOW_DSC = '03' THEN '고등'
			 		WHEN B.MCOW_DSC = '09' THEN '미등록우'
			 		ELSE ''
			 	END AS MCOW_DSC_NM
			 , CONVERT(NUMERIC(13, 0), B.MATIME) AS MATIME		/* 산차 */
			 , CONVERT(NUMERIC(13, 0), A.PRNY_MTCN) AS PRNY_MTCN	/* 임신개월수 */
			 , B.SRA_INDV_PASG_QCN 			/* 계대 */
			 , B.INDV_ID_NO 				/* 계체식벌번호 */
			 , B.SRA_INDV_BRDSRA_RG_NO 		/* 축산개체종축등록번호 */
			 , B.RG_DSC 					/* 등록구분번호 */
			 , CASE WHEN B.RG_DSC = '01' THEN '기초'
			 		WHEN B.RG_DSC = '02' THEN '혈통'
			 		WHEN B.RG_DSC = '03' THEN '고등'
			 		WHEN B.RG_DSC = '09' THEN '미등록우'
			 		ELSE ''
			 	END AS RG_DSC_NM
			 , A.SRA_PDMNM
			 , A.SRA_PD_RGNNM 				/* 축산생산지역 */
			 , A.DNA_YN						/* 친자검사결과여부 */
			 , B.ANW_YN 					/* 신규여부 */
			 , CONVERT(NUMERIC(13, 0), A.COW_SOG_WT) AS COW_SOG_WT	/* 우출하중량 */
			 , CONVERT(NUMERIC(13, 0), ROUND(A.FIR_LOWS_SBID_LMT_AM / 10000, 0)) AS FIR_LOWS_SBID_LMT_AM		/* 최초최저낙찰한도금액 */
			 , CONVERT(NUMERIC(13, 0), ROUND(A.LOWS_SBID_LMT_AM / 10000, 0)) AS LOWS_SBID_LMT_AM			/* 최저낙찰한도금액 */
			 , A.RMK_CNTN					/* 비고내용 */
			 , A.SEL_STS_DSC 				/* 낙유찰결과 */
			 , (SELECT D.SRA_MWMNNM 
				  FROM TB_LA_IS_MM_MWMN D
				 WHERE D.NA_BZPLC = A.NA_BZPLC
				   AND D.TRMN_AMNNO = A.TRMN_AMNNO
			 ) AS SRA_MWMNNM 				/* 낙찰자 */
			 , A.LVST_AUC_PTC_MN_NO			/* 낙찰자 참가 번호 */
			 , A.TRMN_AMNNO					/* 낙찰자 중도매인 번호 */
			 , A.SRA_SBID_UPR				/* 낙찰금액 */
			 , CONVERT(NUMERIC(13, 0), ROUND(A.SRA_SBID_AM / 10000, 0)) AS SRA_SBID_AM		/* 낙찰금액 */
			 , (SELECT TOP(1) E.ATDR_DTM 
				  FROM TB_LA_IS_MH_ATDR_LOG E
				 WHERE E.NA_BZPLC = A.NA_BZPLC
				   AND E.AUC_OBJ_DSC = A.AUC_OBJ_DSC 
				   AND E.AUC_DT = A.AUC_DT
				   AND E.OSLP_NO = A.OSLP_NO
				   AND E.TRMN_AMNNO = A.TRMN_AMNNO
				   AND E.LVST_AUC_PTC_MN_NO = A.LVST_AUC_PTC_MN_NO
				   AND E.ATDR_AM = A.SRA_SBID_UPR
				 ORDER BY E.ATDR_DTM DESC
			 ) AS ATDR_DTM					/* 응찰일시 */
		  FROM TB_LA_IS_MH_SOG_COW A
		  LEFT OUTER JOIN TB_LA_IS_MM_INDV B
			ON (
				A.NA_BZPLC = B.NA_BZPLC
				AND
				A.SRA_INDV_AMNNO = B.SRA_INDV_AMNNO 
				AND
				A.SRA_SRS_DSC = B.SRA_SRS_DSC 
			 )
		 WHERE A.NA_BZPLC = #{naBzplc}
	<choose>
		<when test="searchDate != null and searchDate != ''">
		   AND A.AUC_DT = #{searchDate}
		</when>
		<otherwise>
		   AND A.AUC_DT = CONVERT(VARCHAR, GETDATE(), 112)
		</otherwise>
	</choose>
		 ORDER BY A.AUC_DT DESC, A.AUC_OBJ_DSC ASC, A.AUC_PRG_SQ ASC
	</select>
	
	<select id="selectMyEntryList" parameterType="map" resultType="map">
		select TOP(1) 
			NA_BZPLC
			 , AUC_DT
			 , AUC_OBJ_DSC
			 , LVST_AUC_PTC_MN_NO
			 , TRMN_AMNNO
			 , TR_DFN_YN
			 , AUC_ENTR_GRN_AM
			 , RTRN_YN
			 , TMS_YN
			 , DEL_YN
			 , FSRG_DTM
			 , FSRGMN_ENO
			 , LSCHG_DTM
			 , LS_CMENO
		  FROM TB_LA_IS_MH_AUC_ENTR
		 WHERE NA_BZPLC = #{naBzplc}
		   AND AUC_DT = CONVERT(VARCHAR, GETDATE(), 112)
		   <if test="aucObjDsc != null">
			   AND AUC_OBJ_DSC IN (
				   <foreach item="item" collection="aucObjDsc" separator=",">
		        		#{item}
				  </foreach>
			  )
		  </if>
		   AND TRMN_AMNNO = #{trmnAmnno}
		   ORDER BY FSRG_DTM DESC
	</select>
</mapper>